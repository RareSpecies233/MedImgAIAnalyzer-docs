# web客户端交互逻辑

- 模式选择（可选功能：账号系统）
  - 手动模式/专家模式
    - CT图像预处理
      - 打开图像（打开后先计算sha256，计算完成后上传服务端，服务端返回这个文件是否有被处理过）（多格式:png nii dicom npz）（打开非PNG时，先计算上传服务端，转换为PNG后返回客户端以供显示）
      - 图像转换（服务端实现）
      - 图像增强（裁剪、缩放）（客户端处理PNG，服务端接受处理参数，处理nzp以供ai分析使用）
    - CT图像Ai分析【如果未完成预处理，则提示用户先进行预处理】
      - Ai图像分析（处理nzp，处理完成之后转为png发送客户端显示）
      - Ai分析前后图像、人工标定图像三者之间对比（缩放锁定、x轴、y轴平移锁定、重置）（全部为客户端实现）
    - CT图像三维重建与分析【如果未完成预处理，则提示用户先进行预处理；如果未完成Ai分析，则只显示原始3D模型且无对比功能】
      - 显示多个（可选）三维模型并进行对比（缩放锁定、x轴、y轴、平移锁定、旋转锁定、重置）（全部为客户端实现）
      - 一键显示
    - 大模型问诊【结合所有之前的信息，同时带有RAG功能，可以管理RAG的相关文献，使用Qwen3-0.6b作为本地模型，支持API接入】
      - 聊天界面（可以键盘输入或语音输入，可以提问之前的信息和RAG中的信息，如果提问不相干信息则委婉回拒）
  - Ai模式
    - 聊天界面可以完成以上的所有流程，依靠ToDo List的节点）
    - Todo List界面（引导用户的功能，同时为后台模型节点的前端提示，可Debug使用）

## web端功能列表：

### 基础界面：

1. 打开图像/显示图像界面（实际为上传），需要有上传提示进行占位（如果不是PNG，则也要进度包含上传与下载）
2. 图像转换模块（若干个按钮，点击后转换为进度，服务端先传来最近10次转换的平均时间以供进度显示，进度条最多显示90%，当服务端处理完成后过渡到100%）
3. 图像增强模块（客户端进行裁剪、缩放，并将对于图像的操作的参数传给服务端，服务端操作，点击保存后显示进度条，同上为最近10次时间）
4. ai分析按钮，整体样式与打开图像类似，未分析时仅显示按钮（点击分析无需向服务端上传，使用服务端已有的内容）
5. 图像对比功能（打开后，分析界面缩小为按钮，此界面从按钮放大为窗口）（纯客户端实现，与原始图像对比，缩放锁定、x轴、y轴平移锁定）
6. 三维功能（可以显示多个模型，有快捷按钮，三维模型格式为glb，使用threejs处理）

### ai界面：

1. 聊天界面
2. ToDo List

## web端开发流程

- 除Ai以外功能全部开发在一页中（基础界面），后续进行删减与分叉以便代码复用
- Ai功能单独开发在Ai界面中（Ai界面），同上
- 主界面后续再开发（仅作route作用），框架界面后续再开发（界面导航，可以添加Log功能）

## 后端如何实现多文件的？

- 所有文件均使用XXH3进行索引，每次的请求也包含XXH3，后端文件夹直接使用xxh3命名
